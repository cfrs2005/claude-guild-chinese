---
title: 第二章 命令系统
description: 斜杠命令、钩子系统和自动化集成的完整指南
nav_order: 3
---

# 第二章 命令系统

> **掌握 Claude Code 的自动化能力**  
> 深入理解斜杠命令、钩子系统和 MCP 集成，构建高效的开发自动化流程

## 📋 本章目录

- [学习目标](#学习目标)
- [斜杠命令系统](#斜杠命令系统)
  - [核心命令概览](#核心命令概览)
  - [进阶命令](#进阶命令预览功能)
  - [自定义命令开发](#自定义命令开发)
- [钩子系统](#钩子系统)
  - [钩子机制原理](#钩子机制原理)
  - [核心钩子类型](#核心钩子类型)
- [MCP 集成系统](#mcp-集成系统)
  - [MCP 架构概览](#mcp-架构概览)
  - [主流 MCP 集成](#主流-mcp-集成)
- [子代理系统](#子代理系统)
  - [专业化代理架构](#专业化代理架构)
  - [多代理协作模式](#多代理协作模式)
- [实战应用场景](#实战应用场景)
- [本章小结](#本章小结)

---

## 🎯 学习目标

完成本章学习后，你将：
- 熟练使用内置和自定义斜杠命令
- 掌握钩子系统的配置和应用场景
- 理解 MCP 集成和子代理系统
- 构建完整的自动化开发工作流

---

## ⚡ 斜杠命令系统

### 核心命令概览

斜杠命令是 Claude Code 的**快捷操作入口**，提供结构化的功能访问：

| 命令类别 | 命令 | 功能 | 使用场景 |
|----------|------|------|----------|
| **会话管理** | `/clear` | 清除对话历史 | 切换项目上下文 |
| **帮助系统** | `/help` | 获取命令帮助 | 查询功能说明 |
| **代码审查** | `/review` | 请求代码审查 | 质量检查和优化建议 |
| **模型切换** | `/model` | 选择 AI 模型 | 根据任务复杂度调整 |
| **上下文管理** | `/compact` | 压缩对话内容 | 优化令牌使用 |
| **目录管理** | `/add-dir` | 添加工作目录 | 扩展项目范围 |

### 进阶命令（预览功能）

```bash
# 后台进程管理
/bashes              # 列出所有后台进程
/bash-output <id>    # 获取后台进程输出
/kill-bash <id>      # 终止后台进程

# 界面定制
/statusline <expr>   # 自定义状态栏显示
/microcompact        # 智能上下文清理

# 代理管理
/agents              # 管理自定义子代理
```

### 自定义命令开发

#### 命令文件结构

```bash
# 项目级命令
.claude/commands/
├── deploy.md        # 部署命令
├── test-suite.md    # 测试套件
└── security-scan.md # 安全扫描

# 用户级命令
~/.claude/commands/
├── code-review.md   # 代码审查模板
├── refactor.md      # 重构助手
└── performance.md   # 性能分析
```

---

## 🔗 钩子系统

### 钩子机制原理

钩子系统提供**事件驱动的自动化**，在特定操作时自动触发预定义的脚本：

```yaml
钩子架构:
  事件监听:
    - 文件操作事件 (读取/写入/编辑)
    - 命令执行事件 (开始/结束)
    - Git 操作事件 (提交/推送/合并)
    - 会话管理事件 (开始/结束/压缩)
  
  处理流程:
    事件触发 → 钩子匹配 → 脚本执行 → 结果处理 → 后续动作
  
  响应控制:
    - 阻塞式处理 (必须等待完成)
    - 非阻塞式处理 (后台执行)
    - 条件性处理 (基于返回值决定)
```

### 核心钩子类型

| 钩子事件 | 触发时机 | 典型应用 |
|----------|----------|----------|
| `on_file_write` | 文件写入后 | 代码格式化、语法检查 |
| `on_git_commit` | Git 提交时 | 代码质量检查、安全扫描 |
| `on_command_start` | 命令开始前 | 环境检查、权限验证 |
| `on_session_start` | 会话开始时 | 项目上下文加载 |
| `on_error` | 错误发生时 | 错误日志、故障恢复 |

---

## 🌐 MCP 集成系统

### MCP 架构概览

模型上下文协议 (MCP) 提供**标准化的外部集成接口**：

```yaml
MCP 生态系统:
  核心协议:
    - 统一的服务发现机制
    - 标准化的数据交换格式
    - 安全的认证和授权框架
  
  集成类型:
    数据源集成: 数据库、API、文件系统
    工具集成: Docker、Kubernetes、云服务
    通信集成: Slack、Teams、邮件系统
    开发集成: Git、CI/CD、监控系统
```

### 主流 MCP 集成

#### GitHub 集成配置

```json
{
  "name": "github-integration",
  "server": "github-mcp",
  "config": {
    "authentication": {
      "type": "token",
      "token": "${GITHUB_TOKEN}"
    },
    "repositories": [
      "owner/frontend-app",
      "owner/backend-api"
    ],
    "permissions": {
      "issues": "read_write",
      "pull_requests": "read_write"
    }
  }
}
```

---

## 🤖 子代理系统

### 专业化代理架构

子代理系统提供**领域专业化的 AI 协作**：

```javascript
// 安全专家代理
const SecurityExpert = {
  name: "网络安全专家",
  expertise: [
    "OWASP Top 10 漏洞分析",
    "渗透测试和安全审计",
    "合规性检查 (SOC2, GDPR)"
  ],
  workflow: [
    "威胁建模和风险评估",
    "代码安全审查",
    "漏洞扫描和测试"
  ]
}

// 使用方式
"@security-expert 全面审查这个支付系统的安全性"
```

---

## 📖 本章小结

通过本章学习，你已经掌握了 Claude Code 的完整自动化能力：

✅ **斜杠命令**：熟练使用内置命令和开发自定义命令  
✅ **钩子系统**：构建事件驱动的自动化流程  
✅ **MCP 集成**：连接外部系统和服务  
✅ **子代理协作**：利用专业化 AI 代理提升工作效率  

**下一步**：进入 [第三章 开发工作流](03-开发工作流.html)，学习如何将这些工具整合到完整的开发流程中。